<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./WEB-INF/templates/default.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core">

    <ui:define name="title">
        - Rutas
    </ui:define>

    <ui:define name="content">
        <h:head>
            <title>Calcular Rutas</title>
            <script src=" http://maps.google.com/?file=api&amp;v=2.x&amp;key=ABQIAAAAUnJY3ChJhF0YgyTSDJuVfBTqu-zEVMNfNVaqfAe9FKyfKhfBExSs9LrIQ7GOuBeSnaddg05sRmEBxQ"
            type="text/javascript"></script>
            <script type="text/javascript">
 
                var map;
                var gdir;
                var geocoder = null;
                function load() {
                    if (GBrowserIsCompatible()) {
                        map = new GMap2(document.getElementById("map"));	
                        gdir = new GDirections(map, document.getElementById("direcciones"));
                        GEvent.addListener(gdir, "load", onGDirectionsLoad);
                        GEvent.addListener(gdir, "error", mostrarError);	
                        obtenerRuta("Madrid, Spain", "Toledo, Spain");	
                    }
                }
		
                function obtenerRuta(desde, hasta) {
                    var i;
                    var tipo;
                 
                    //conduccion
                    gdir.load("from: " + desde + " to: " + hasta,
                    { "locale": "es", "travelMode" : G_TRAVEL_MODE_DRIVING });
                    
                }
	
                function onGDirectionsLoad(){ 
                    //resumen de tiempo y distancia
                    document.getElementById("getDistance").innerHTML =gdir.getSummaryHtml(); 
                } 
	
                function mostrarError(){
                    if (gdir.getStatus().code == G_GEO_UNKNOWN_ADDRESS)
                        alert("No se ha encontrado una ubicaci�n geogr�fica que se corresponda con la direcci�n especificada.");
                    else if (gdir.getStatus().code == G_GEO_SERVER_ERROR)
                        alert("No se ha podido procesar correctamente la solicitud de ruta o de c�digos geogr�ficos, sin saberse el motivo exacto del fallo.");
                    else if (gdir.getStatus().code == G_GEO_MISSING_QUERY)
                        alert("Falta el par�metro HTTP q o no tiene valor alguno. En las solicitudes de c�digos geogr�ficos, esto significa que se ha especificado una direcci�n vac�a.");
                    else if (gdir.getStatus().code == G_GEO_BAD_KEY)
                        alert("La clave proporcionada no es v�lida o no coincide con el dominio para el cual se ha indicado.");
                    else if (gdir.getStatus().code == G_GEO_BAD_REQUEST)
                        alert("No se ha podido analizar correctamente la solicitud de ruta.");
                    else alert("Error desconocido.");
	   
                }
            </script>
        </h:head>
        <h:body>
            <div class="container">
                <div class="row">
                    <div class="span5 offset0">

                        <h2>Calcular Rutas</h2>
                        <label class="control-label " for="program">Ciudad de Partida:</label>
                        <div class="controls">
                            <h:selectOneMenu required="true" 
                                             requiredMessage = "¡Por favor selecciona una ciudad!">
                                <f:selectItem itemLabel=""/>
                                <f:selectItems value="#{pointBean.points}" />
                                <f:validateLongRange minimum="1" />
                            </h:selectOneMenu>
                        </div>
                        <label class="control-label " for="program">Ciudad de Destino:</label>
                        <div class="controls">
                            <h:selectOneMenu required="true" 
                                             requiredMessage = "¡Por favor selecciona una ciudad!">
                                <f:selectItem itemLabel=""/>
                                <f:selectItems value="#{pointBean.points}" />
                                <f:validateLongRange minimum="1" />
                            </h:selectOneMenu>
                        </div>
                        <h:commandButton value="Calcular ruta" class="btn btn-large btn-primary" />

                        <tr>
                            <td>
                                <strong>Mapa</strong>
                            </td>
                        </tr>
                        <tr>
                            <td valign="top">
                                <div id="map" style="width: 500px; height: 400px"></div>
                            </td>
                        </tr>



                    </div>
                    <div class="span5 offset0">
                        <tr>
                            <td>
                                <strong>Direcciones de la ruta</strong>
                            </td>
                        </tr>
                        <tr>
                            <td valign="top">
                                Distancia y tiempo: <div id="getDistance"></div>
                                <div id="direcciones" style="width: 330px"></div>
                            </td>
                        </tr>

                    </div>
                </div>
            </div>



            <script>
                window.onload = load;
                window.onunload = GUnload;
            </script>
        </h:body>
    </ui:define>

</ui:composition>
